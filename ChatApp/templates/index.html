<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Multiverse Empire Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        /* [ì§€ë°°ì ë° ì‹œìŠ¤í…œ íš¨ê³¼] */
        @keyframes golden-glow {
            0%, 100% { box-shadow: 0 0 20px #ffd700; border-color: #ffd700; }
            50% { box-shadow: 0 0 40px #fff, inset 0 0 20px #ffd700; border-color: #fff; }
        }
        @keyframes screen-flash {
            0% { background: rgba(255, 215, 0, 0); }
            50% { background: rgba(255, 215, 0, 0.2); }
            100% { background: rgba(255, 215, 0, 0); }
        }
        @keyframes news-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); background: #334155; }
            100% { transform: scale(1); }
        }
        
        body { background: #020617; color: white; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 140px; scroll-behavior: smooth; }
        
        /* ë­í‚¹ ë° ë“±ê¸‰ ìŠ¤íƒ€ì¼ */
        .rank-ì§€ë°°ì { background: linear-gradient(to right, #ffd700, #ffffff, #ffcc00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; filter: drop-shadow(0 0 8px gold); }
        .bubble-ì§€ë°°ì { animation: golden-glow 2s infinite !important; background: rgba(255, 215, 0, 0.1) !important; border: 2px solid #ffd700 !important; }
        .crown { font-size: 1.5rem; vertical-align: middle; animation: bounce 2s infinite; display: inline-block; }
        
        /* ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë° !ë­í‚¹ ì§€ì› ìŠ¤íƒ€ì¼ */
        .system-msg { 
            background: #1e293b; 
            color: #94a3b8; 
            padding: 10px 20px; 
            border-radius: 15px; 
            font-size: 12px; 
            border: 1px solid #334155; 
            max-width: 90%; 
            text-align: left; 
            white-space: pre-wrap; /* !ë­í‚¹ ì¤„ë°”ê¿ˆ ìœ ì§€ìš© */
            display: inline-block;
        }
        .news-msg { 
            background: #0f172a; 
            color: #fbbf24; 
            border: 1px solid #fbbf24; 
            animation: news-pulse 0.5s ease-in-out; 
            font-weight: bold; 
            text-align: center;
        }

        .reward-badge { background: #1e293b; color: #fbbf24; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-left: 5px; }
        .chat-link { color: #38bdf8; text-decoration: underline; font-weight: bold; }
        /* 1995ë…„ë„ ì œêµ­ì£¼ì˜ ìŠ¤íƒ€ì¼ */
        #input-area {
        border-top: 4px ridge #ffd700; /* í™©ì‹¤ ë¬¸ì–‘ ê°™ì€ ì…ì²´ì ì¸ ê²½ê³„ì„  */
        background: #1a1a1a;
        }
        input[type="text"] {
        border: 3px inset #555; /* 90ë…„ëŒ€ í”„ë¡œê·¸ë¨ ëŠë‚Œì˜ ì›€í‘¹ ë“¤ì–´ê°„ ì…ë ¥ì°½ */
        font-family: 'Gulim', 'êµ´ë¦¼', sans-serif; /* 95ë…„ë„ í‘œì¤€ í°íŠ¸ ê°ì„± */
        }
        button {
        border: 3px outset #8b4513; /* ê³ ì „ì ì¸ íŠ€ì–´ë‚˜ì˜¨ ë²„íŠ¼ ëŠë‚Œ */
        background: #4a3728; /* í™©ì‹¤ì˜ ê³ í’ìŠ¤ëŸ¬ìš´ ê°ˆìƒ‰/ê¸ˆìƒ‰ ì¡°í™” */
        color: #ffd700;
        text-shadow: 1px 1px 0px black;
        }
        button:active {
        border: 3px inset #8b4513; /* ëˆŒë €ì„ ë•Œ 95ë…„ë„ í´ë¦­ ê°ì„± */
        }
        /* 1. ì „ì²´ ë°°ê²½: ê¹Šì€ í™©ì‹¤ ë‚¨ìƒ‰ê³¼ ì§ˆê° ì¶”ê°€ */
        body {
        background-color: #050a18;
        background-image: url('https://www.transparenttextures.com/patterns/asfalt-dark.png'); /* ë¯¸ì„¸í•œ ë…¸ì´ì¦ˆ ì§ˆê° */
        color: #e0e0e0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        }

        /* 2. ì±„íŒ… ì˜ì—­: ê³ ë¬¸ì„œ ëŠë‚Œì˜ ì€ì€í•œ í…Œë‘ë¦¬ì™€ ë°°ê²½ */
        #chat {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        padding-bottom: 140px;
        scroll-behavior: smooth;
        background: rgba(10, 15, 30, 0.6); /* ë°˜íˆ¬ëª…í•œ ì–´ë‘  */
        border-left: 4px double #8b4513;
        border-right: 4px double #8b4513;
        margin: 0 10px;
        }

        /* 3. í‹°ì»¤(ì‹œì„¸ì°½): ê¸ˆë°•ì„ ì…íŒ ë“¯í•œ ìŠ¤íƒ€ì¼ */
        #ticker {
        background: linear-gradient(to bottom, #4a3728, #2b1d0e);
        color: #ffd700;
        border-bottom: 2px solid #ffd700;
        font-family: 'Gulim', 'êµ´ë¦¼', sans-serif;
        font-weight: bold;
        padding: 8px;
        text-shadow: 1px 1px 2px black;
        box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* 4. ìŠ¤í¬ë¡¤ë°”ë„ ë ˆíŠ¸ë¡œí•˜ê²Œ ë³€ê²½ */
        #chat::-webkit-scrollbar { width: 12px; }
        #chat::-webkit-scrollbar-track { background: #1a1a1a; }
        #chat::-webkit-scrollbar-thumb {
        background: #4a3728;
        border: 2px outset #8b4513;
        }
        /* 1. ì§€ë°°ì ì „ìš© ì¹™ë ¹(ë§í’ì„ ) ì»¤ìŠ¤í…€: ë‚¡ì€ ì–‘í”¼ì§€ ë° ê¸ˆìƒ‰ í…Œë‘ë¦¬ */
        .bubble-ì§€ë°°ì {
        animation: golden-glow 2s infinite !important;
        background: linear-gradient(135deg, #f3e5ab 0%, #e8c547 100%) !important; /* ì–‘í”¼ì§€ í™©ê¸ˆìƒ‰ */
        border: 3px double #8b4513 !important; /* ê³ í’ìŠ¤ëŸ¬ìš´ ì´ì¤‘ í…Œë‘ë¦¬ */
        box-shadow: 0 10px 20px rgba(0,0,0,0.5), inset 0 0 15px rgba(255,255,255,0.5) !important;
        }
        /* ì§€ë°°ì ë©”ì‹œì§€ í…ìŠ¤íŠ¸ëŠ” ê²€ì€ìƒ‰ìœ¼ë¡œ ê°€ë…ì„± í™•ë³´ */
        .bubble-ì§€ë°°ì .text-sm {
        color: #2b1d0e !important;
        font-weight: bold;
        text-shadow: none !important;
        }

        /* 3. í‹°ì»¤ ì˜ì—­ í™•ì¥: ì§€ë°°ì ìì‚° ê³ ì • í‘œê¸° ìŠ¤íƒ€ì¼ */
        #master-wealth {
        margin-left: 20px;
        padding-left: 20px;
        border-left: 2px solid #ffd700;
        color: #ffffff;
        text-shadow: 0 0 5px #ffd700;
        }
    </style>
</head>
<body id="main-body">
    <div class="py-8 text-center bg-[#020617] border-b-4 border-double border-[#ffd700] relative overflow-hidden">
        <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');"></div>
        <div class="relative z-10">
            <h1 class="text-4xl font-serif font-black tracking-widest text-white italic"
                style="text-shadow: 3px 3px 0px #8b4513, 6px 6px 0px #ffd700; font-family: 'Gungsuh', 'ê¶ì„œ', serif;">
                å¤§éŸ“ Multiverse <span class="rank-ì§€ë°°ì">Empire</span>
            </h1>
            <div class="flex justify-center items-center gap-4 mt-2">
                <span class="h-[1px] w-12 bg-[#ffd700]"></span>
                <p class="text-xs font-mono text-[#ffd700] tracking-[0.3em] uppercase">
                    Established 1995 â€¢ ê±´ì–‘(å»ºé™½) ì›ë…„
                </p>
                <span class="h-[1px] w-12 bg-[#ffd700]"></span>
            </div>
        </div>
    </div>
    <div id="ticker" class="flex justify-between items-center px-6">
        <div>
            ğŸª™ ì‹¤ì‹œê°„ ë¹„íŠ¸ì½”ì¸ ì‹œì„¸: <span id="btc-price">50,000,000
        </span>â‚©
        </div>
        <div id="master-wealth">
            ğŸ‘‘ Joyce ì§€ë°°ì ìì‚°: <span id="total-wealth" class="text-yellow-400">26,676,094,401</span>â‚©
        </div>
    </div>

    <div id="chat" class="space-y-4"></div>
    <div id="input-area">
        <div id="f-ready" class="hidden text-xs text-yellow-400 mb-2 font-bold">ğŸ“œ ìƒì†Œë¬¸(íŒŒì¼)ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
        <div class="flex gap-2">
            <label class="bg-[#4a3728] border-2 border-outset border-[#8b4513] p-2 cursor-pointer text-sm">
                ğŸ“ <input type="file" id="f-in" class="hidden" onchange="document.getElementById('f-ready').classList.remove('hidden')">
            </label>
            <input type="text" id="msg"
                   class="flex-1 bg-white text-black border-3 border-inset border-[#555] px-4 text-sm"
                   placeholder="ì¹™ë ¹ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤..."
                   onkeypress="if(event.keyCode==13) send()"
                   style="border-style: inset; border-width: 3px;">
            <button onclick="send()" class="px-6 py-2 font-bold">ë°œì†¡</button>
        </div>
    </div>
    <script>
        const socket = io(); // âœ… ê°€ì¥ ë¨¼ì € ì†Œì¼“ì„ ì´ˆê¸°í™”í•´ì•¼ í•©ë‹ˆë‹¤!

        let nick = prompt("ì œêµ­ì—ì„œ ì‚¬ìš©í•  ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", "Joyce");
        if (!nick) nick = "ìµëª…_" + Math.floor(Math.random() * 1000);
        socket.emit('join', {nickname: nick});

        // ì‹œì„¸ ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ
        socket.on('price_update', (data) => {
            const priceEl = document.getElementById('btc-price');
            const oldPrice = parseInt(priceEl.innerText.replace(/,/g, '')) || 0;
            priceEl.innerText = data.btc.toLocaleString();
            priceEl.style.color = data.btc > oldPrice ? "#ef4444" : "#3b82f6";
        });

        function linkify(t) { 
            return t.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig, 
            '<a href="$1" target="_blank" class="chat-link">$1</a>'); 
        }

        socket.on('message', (d) => {
    const chat = document.getElementById('chat');
    const div = document.createElement('div');
    const isMaster = d.rank === 'ë©€í‹°ë²„ìŠ¤ ì§€ë°°ì';
    const isMe = d.nickname === nick; // í˜„ì¬ ì ‘ì†í•œ 'ë‚˜'ì¸ì§€ í™•ì¸

    // [ìˆ˜ì •] ë‚´ ë©”ì‹œì§€ì— ëŒ€í•œ ì‘ë‹µì´ê±°ë‚˜, ë‚˜ì—ê²Œ ì˜¨ ì‹œìŠ¤í…œ ë©”ì‹œì§€ì— ìì‚° ì •ë³´ê°€ ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸
    if (isMe && d.total_asset !== undefined) {
        const wealthEl = document.getElementById('total-wealth');
        if (wealthEl) {
            wealthEl.innerText = Number(d.total_asset).toLocaleString();
        }
    }

    // ì§€ë°°ì ëŒ€í™” ë˜ëŠ” ì œêµ­ ì†ë³´ ë°œìƒ ì‹œ í™”ë©´ í”Œë˜ì‹œ íš¨ê³¼
    if (isMaster || (d.msg && d.msg.includes('ğŸš¨ [ì œêµ­ ì†ë³´]'))) {
        document.getElementById('main-body').style.animation = 'screen-flash 0.8s ease-in-out';
        setTimeout(() => document.getElementById('main-body').style.animation = '', 800);
    }

    if (['system', 'noejul', 'bot'].includes(d.type)) {
        const isNews = d.msg.includes('ğŸš¨');
        div.className = "flex justify-center my-2";
        div.innerHTML = `<span class="system-msg ${isNews ? 'news-msg' : ''}">${d.msg}</span>`;
    } else {
        div.className = `flex ${isMe ? 'justify-end' : 'justify-start'} animate-fade-in`;

        // 1ë²ˆ ê¸°ëŠ¥ ì ìš©: ì§€ë°°ìì¼ ê²½ìš° 'bubble-ì§€ë°°ì'ë§Œ ì ìš©í•˜ê³  ë°°ê²½ìƒ‰ ì œê±°
        const bubbleClass = isMaster
            ? "bubble-ì§€ë°°ì p-4 rounded-lg shadow-xl"
            : "p-4 rounded-2xl bg-slate-800 border border-slate-700 shadow-xl";

        div.innerHTML = `
            <div class="max-w-[85%]">
                <div class="flex items-center gap-1 mb-1 ${isMe ? 'flex-row-reverse' : ''}">
                    ${isMaster ? '<span class="crown">ğŸ‘‘</span>' : ''}
                    <span class="text-xs font-bold ${isMaster ? 'rank-ì§€ë°°ì' : 'text-slate-400'}">${d.nickname}</span>
                    <span class="text-[9px] text-slate-600 ml-1">[${d.rank}]</span>
                    <span class="reward-badge">${d.reward || ''}</span>
                </div>
                <div class="${bubbleClass}">
                    <div class="text-sm whitespace-pre-wrap break-all">${linkify(d.msg)}</div>
                </div>
            </div>`;
    }
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
});

        async function send() {
            const i = document.getElementById('msg'); 
            const fi = document.getElementById('f-in');
            
            if (fi.files[0]) {
                const fd = new FormData(); 
                fd.append('file', fi.files[0]); 
                fd.append('nickname', nick);
                await fetch('/upload', { method: 'POST', body: fd }); 
                fi.value = ''; 
                document.getElementById('f-ready').classList.add('hidden');
            }
            
            if (i.value.trim()) { 
                socket.emit('send_msg', {nickname: nick, msg: i.value}); 
                i.value = ''; 
            }
        }
    </script>
</body>
</html>